devtools::install(build_vignettes = T)
browseVignettes()
browseVignettes('ULM')
browseVignettes()
devtools::build_readme()
#########website
usethis::use_pkgdown()
pkgdown::build_site()
devtools::build_readme()
ℹ Installing ULM in temporary library
devtools::build_readme()
pkgdown::build_site()
#########website
usethis::use_pkgdown()
#########website
usethis::use_pkgdown()
pkgdown::build_site()
#########website
usethis::use_pkgdown()
pkgdown::build_site()
usethis::use_pkgdown_github_pages()
usethis::use_pkgdown_github_pages()
usethis::gh_token_help()
usethis::use_pkgdown_github_pages()
usethis::gh_token_help()
usethis::use_pkgdown_github_pages()
usethis::gh_token_help()
usethis::create_github_token()
gitcreds::gitcreds_set()
usethis::use_pkgdown_github_pages()
gitcreds::gitcreds_set()
gitcreds::gitcreds_set()
usethis::use_pkgdown_github_pages()
pkgdown::build_site()
usethis::use_pkgdown_github_pages()
pkgdown::deploy_to_branch()
browseVignettes('ULM')
pkgdown::preview_site()
pkgdown::build_site()
library(magick)
library(purrr)
sticker_files <- list.files("hex-stickers", full.names = TRUE)
stickers <- sticker_files %>%
map(compose(image_read, ~ image_transparent(., "white"), image_trim, .dir = "forward")) %>%
set_names(basename(sticker_files))
library(magick)
library(purrr)
sticker_files <- list.files("hex-stickers", full.names = TRUE)
stickers <- sticker_files %>%
map(compose(image_read, ~ image_transparent(., "white"), image_trim, .dir = "forward")) %>%
set_names(basename(sticker_files))
sticker_files <- list.files("hex-stickers", full.names = TRUE)
pkgdown::build_site()
library(ULM)
PlotNetwork(query_network_df, node_text_size = 10, legend_text_size = 20, legend_title_size = 20, main_size = 25)
devtools::document()
pkgdown::build_site()
devtools::document()
pkgdown::build_site()
##########test
usethis::use_testthat(3)
usethis::use_test("FilterMultiplet")
devtools::test()
devtools::test()
devtools::test()
devtools::test()
mat <- matrix(rpois(200, lambda = 5), nrow = 20, ncol = 10,
dimnames = list(paste0("gene", 1:20), paste0("cell", 1:10)))
seurat_obj <- CreateSeuratObject(mat)
library(Seurat)
mat <- matrix(rpois(200, lambda = 5), nrow = 20, ncol = 10,
dimnames = list(paste0("gene", 1:20), paste0("cell", 1:10)))
seurat_obj <- CreateSeuratObject(mat)
View(mat)
test_that("FilterMultiplet works as expected", {
library(Seurat)
# ---- Create mock Seurat object ----
mat <- matrix(rpois(200, lambda = 5), nrow = 20, ncol = 10,
dimnames = list(paste0("gene", 1:20), paste0("cell", 1:10)))
seurat_obj <- CreateSeuratObject(mat)
# add metadata (fake multiplet annotations)
seurat_obj$count_ulm <- c(1,2,3,2,5,1,4,2,3,1)
seurat_obj$celltype_ulm <- c("A","B","B","A","C","C","B","A","C","B")
# ---- Run function ----
res <- FilterMultiplet(seurat_obj, minCells = 2, minFreq = 2)
# ---- Tests ----
expect_type(res, "list")
expect_named(res, c("multSummaryFilt", "multObjFilt"))
# Check multSummaryFilt has expected structure
expect_true(all(c("multipletType", "frequency") %in% colnames(res$multSummaryFilt)))
# Frequencies should all be >= minFreq
expect_true(all(res$multSummaryFilt$frequency >= 2))
# multObjFilt should be a Seurat object
expect_s4_class(res$multObjFilt, "Seurat")
})
test_that("FilterMultiplet works as expected", {
library(Seurat)
# ---- Create mock Seurat object ----
mat <- matrix(rpois(200, lambda = 5), nrow = 20, ncol = 10,
dimnames = list(paste0("gene", 1:20), paste0("cell", 1:10)))
seurat_obj <- CreateSeuratObject(mat)
# add metadata (fake multiplet annotations)
seurat_obj$count_ulm <- c(1,2,3,2,5,1,4,2,3,1)
seurat_obj$celltype_ulm <- c("A","B","B","A","C","C","B","A","C","B")
# ---- Run function ----
res <- ULM::FilterMultiplet(seurat_obj, minCells = 2, minFreq = 2)
# ---- Tests ----
expect_type(res, "list")
expect_named(res, c("multSummaryFilt", "multObjFilt"))
# Check multSummaryFilt has expected structure
expect_true(all(c("multipletType", "frequency") %in% colnames(res$multSummaryFilt)))
# Frequencies should all be >= minFreq
expect_true(all(res$multSummaryFilt$frequency >= 2))
# multObjFilt should be a Seurat object
expect_s4_class(res$multObjFilt, "Seurat")
})
test_that("FilterMultiplet works as expected", {
library(Seurat)
# ---- Create mock Seurat object ----
mat <- matrix(rpois(200, lambda = 5), nrow = 20, ncol = 10,
dimnames = list(paste0("gene", 1:20), paste0("cell", 1:10)))
seurat_obj <- CreateSeuratObject(mat)
# add metadata (fake multiplet annotations)
seurat_obj$count_ulm <- c(1,2,3,2,5,1,4,2,3,1)
seurat_obj$celltype_ulm <- c("A","B","B","A","C","C","B","A","C","B")
# ---- Run function ----
res <- ULM::FilterMultiplet(seurat_obj, minCells = 2, minFreq = 2)
# ---- Tests ----
expect_type(res, "list")
expect_named(res, c("multSummaryFilt", "multObjFilt"))
# Check multSummaryFilt has expected structure
expect_true(all(c("multipletType", "frequency") %in% colnames(res$multSummaryFilt)))
# Frequencies should all be >= minFreq
expect_true(all(res$multSummaryFilt$frequency >= 2))
# multObjFilt should be a Seurat object
expect_s4_class(res$multObjFilt, "Seurat")
})
test_that("FilterMultiplet works by filtering multiplets", {
data("int_singData", package = "ULM")
res <- FilterMultiplet(int_singData, minCells = 2, minFreq = 2)
expect_type(res, "list")
expect_named(res, c("multSummaryFilt", "multObjFilt"))
expect_true(all(c("multipletType", "frequency") %in% colnames(res$multSummaryFilt)))
expect_s4_class(res$multObjFilt, "Seurat")
})
test_that("FilterMultiplet filters multiplets correctly", {
# load example data included in package
data("int_multData", package = "ULM")
data("int_signature", package = "ULM")
# compute scores
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:200],   # keep smaller subset for speed
signatures = int_signature,
assay = "RNA",
slot = "data"
)
# assign cells
my_ass <- GetCellAssignments(score_data = my_scores)
# add metadata
new_obj <- AddMetaObject(
seurat_obj = int_multData[, 1:200],
cell_class_df = my_ass
)
# get multiplets
my_mult <- GetMultiplet(seurat_obj = new_obj)
# filter multiplets
my_mult_filt <- FilterMultiplet(seurat_obj = my_mult, minCells = 2, minFreq = 2)
# expectations
expect_type(my_mult_filt, "list")
expect_named(my_mult_filt, c("multSummaryFilt", "multObjFilt"))
expect_true(all(c("multipletType", "frequency") %in% colnames(my_mult_filt$multSummaryFilt)))
expect_s4_class(my_mult_filt$multObjFilt, "Seurat")
# sanity check: filtered frequencies are >= minFreq
expect_true(all(my_mult_filt$multSummaryFilt$frequency >= 2))
})
devtools::test()
devtools::test()
# load example data included in package
data("int_multData", package = "ULM")
data("int_signature", package = "ULM")
library(ULM)
# compute scores
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:200],   # keep smaller subset for speed
signatures = int_signature,
assay = "RNA",
slot = "data"
)
# assign cells
my_ass <- GetCellAssignments(score_data = my_scores)
# add metadata
new_obj <- AddMetaObject(
seurat_obj = int_multData[, 1:200],
cell_class_df = my_ass
)
# get multiplets
my_mult <- GetMultiplet(seurat_obj = new_obj)
View(my_mult)
# filter multiplets
my_mult_filt <- FilterMultiplet(seurat_obj = new_obj, minCells = 2, minFreq = 2)
test_that("FilterMultiplet filters multiplets correctly", {
# load example data included in package
data("int_multData", package = "ULM")
data("int_signature", package = "ULM")
library(ULM)
# compute scores
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:200],   # keep smaller subset for speed
signatures = int_signature,
assay = "RNA",
slot = "data"
)
# assign cells
my_ass <- GetCellAssignments(score_data = my_scores)
# add metadata
new_obj <- AddMetaObject(
seurat_obj = int_multData[, 1:200],
cell_class_df = my_ass
)
# filter multiplets
my_mult_filt <- FilterMultiplet(seurat_obj = new_obj, minCells = 2, minFreq = 2)
# expectations
expect_type(my_mult_filt, "list")
expect_named(my_mult_filt, c("multSummaryFilt", "multObjFilt"))
expect_true(all(c("multipletType", "frequency") %in% colnames(my_mult_filt$multSummaryFilt)))
expect_s4_class(my_mult_filt$multObjFilt, "Seurat")
# sanity check: filtered frequencies are >= minFreq
expect_true(all(my_mult_filt$multSummaryFilt$frequency >= 2))
})
devtools::test()
# add metadata
new_obj <- AddMetaObject(
seurat_obj = int_multData[, 1:200],
cell_class_df = my_ass
)
m
# assign cells
my_ass <- GetCellAssignments(score_data = my_scores)
# compute scores
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:200],   # keep smaller subset for speed
signatures = int_signature,
assay = "RNA",
slot = "data"
)
# assign cells
my_ass <- GetCellAssignments(score_data = my_scores)
# add metadata
new_obj <- AddMetaObject(
seurat_obj = int_multData[, 1:200],
cell_class_df = my_ass
)
# filter multiplets — expect a warning about removed cells
expect_warning(
my_mult_filt <- FilterMultiplet(seurat_obj = my_mult, minCells = 2, minFreq = 2),
regexp = "Removing .* cells missing data"
)
devtools::test()
my_obj <- CreateSeuratObject(int_singData@assays$RNA$counts)
library(Seurat)
my_obj <- CreateSeuratObject(int_singData@assays$RNA$counts)
# compute scores
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:200],   # keep smaller subset for speed
signatures = int_signature,
assay = "RNA",
layer = "data"
)
devtools::install_github('immunogenomics/presto')
Markers <- FindAllMarkers(seurat_obj, only.pos = T)
Markers <- FindAllMarkers(int_singData, only.pos = T)
usethis::use_test("GetSignature")
devtools::test()
devtools::test("GetSignature")
devtools::test()
devtools::test()
usethis::use_test('GetCellScores')
# Load test data from package
data(int_singData, package = ULM)
data(int_signature, , package = "ULM")
data('int_signature', , package = "ULM")
# Load test data from package
data('int_singData', package = ULM)
# Load test data from package
data('int_singData', package = 'ULM')
data('int_signature', package = "ULM")
is.finite(2)
is.finite(Inf)
is.finite(-2)
devtools::test()
devtools::test()
devtools::test()
int_singData[["RNA"]]@layers$mock <- GetAssayData(int_singData, assay = "RNA", slot = "data")
##create a v5 data
v5_multData <- CreateSeuratObject(counts = int_multData@assays$RNA$counts, meta.data = int_multData@meta.data)
class(v5_multData)
Assays(v5_multData)
v5_multData
v5_multData <- v5_multData %>% FindVariableFeatures() %>% NormalizeData() %>% ScaleData()
usethis::use_data(v5_multData, compress = "xz", overwrite = T)
devtools::document()
devtools::document()
devtools::document()
devtools::install()
#########Test layer input (Seurat v5 style)############
data("v5_multData", package = "ULM") ## load Seurat v5 scRNAseq data with layer
###create a v5 data
v5_multData <- CreateSeuratObject(counts = int_multData@assays$RNA$counts, meta.data = int_multData@meta.data)
#########Test layer input (Seurat v5 style)############
data("v5_multData", package = "ULM") ## load Seurat v5 scRNAseq data with layer
v5_multData@assays$RNA$data
pbmc <- CreateSeuratObject(counts = pbmc.counts)
pbmc3k <- LoadData("pbmc3k")
pbmc3k <-Seurat:: LoadData("pbmc3k")
v5_multData@assays$RNA
load("/mnt/8TB/users/shameed/shameed/Doublet predictions/scripts/ULM/data/int_multData.rda")
v5_multData@assays[["RNA"]]@data
v5_multData@assays[["RNA"]]
v5_multData@assays[["RNA"]]$data
GetAssayData(v5_multData)
GetAssayData(v5_multData, assay = 'RNA', slot = 'data')
GetAssayData(v5_multData, assay = 'RNA', layer = 'data')
layers(v5_multData[[assay]], layer = layer)
Seurat::lay
Layers(v5_multData[[assay]], layer = layer)
devtools::test()
devtools::test()
devtools::document()
devtools::document()
devtools::test()
devtools::test()
devtools::test()
devtools::test()
ZhengData <- readRDS("/mnt/8TB/users/shameed/shameed/Zheng/ZhengData.rds")
rm(ZhengData)
nobj <- JoinLayers(nobj)
FindMarkers(int_singData[,1:100])
library(Seurat)
FindMarkers(int_singData[,1:100])
FindAllMarkers(int_singData[,1:100])
JoinLayers(int_singData[,1:100])
objq0 <- JoinLayers(int_singData[,1:100])
objq0 <- JoinLayers(objq0)
devtools::document()
devtools::test()
usethis::use_test('GetCellAssignments')
devtools::test()
devtools::document()
usethis::use_test('AddMetaObjec')
devtools::test()
devtools::test()
devtools::test()
devtools::document()
devtools::test()
devtools::document()
devtools::test()
devtools::test()
detach("package:Seurat", unload = TRUE)
detach("package:SeuratObject", unload = TRUE)
library(Seurat)
library(Seurat, lib.loc = "/usr/local/lib/R/site-library")
detach("package:Seurat", unload = TRUE)
library(SeuratObject, lib.loc = "/usr/local/lib/R/site-library")
detach("package:SeuratObject", unload = TRUE)
library(Seurat)
usethis::use_test('AddMetaObject')
usethis::use_test('GetMultiplet')
devtools::test()
###### Load test data from ULM package
data("int_singData", package = "ULM") ## load scRNAseq data
data("int_signature", package = "ULM") ## load signatures
##Compute signature scores on 200 cells
my_scores <- GetCellScores(
seurat_obj = int_singData[, 1:200],
signatures = int_signature,
assay = "RNA",
layer = "data"
)
library(ULM)
##Compute signature scores on 200 cells
my_scores <- GetCellScores(
seurat_obj = int_singData[, 1:200],
signatures = int_signature,
assay = "RNA",
layer = "data"
)
#######Run function for cell assignments
my_ass <- GetCellAssignments(score_data = my_scores, cut_off = 1, p_val = 0.05)
######### prepare data: run upstream steps
## Compute signature scores on 300 cells
my_scores <- GetCellScores(
seurat_obj = int_multData[, 1:300],
signatures = int_signature,
assay = "RNA",
layer = "data"
)
## Assign cell types
my_ass <- GetCellAssignments(score_data = my_scores)
## Add assignments to metadata
new_obj <- AddMetaObject(seurat_obj = int_multData[, 1:300], cell_class_df = my_ass)
################ run function to extract multiplets
my_mult <- GetMultiplet(seurat_obj = new_obj, minCells = 2)
View(my_mult)
View(my_mult[["multSummary"]])
devtools::test()
devtools::test()
my_mult_filt <- FilterMultiplet(seurat_obj = new_obj, minCells = 2, minFreq = 2)
View(my_mult_filt)
View(my_mult_filt[["multSummaryFilt"]])
devtools::test()
usethis::use_test("GetNodeDF")
devtools::test()
usethis::use_test("PlotNetwork")
######### Generate a dummy multuplet data frame
my_network_df <- data.frame(
Cell1 = c("A", "B", "C", "D", "E", "F"),
Cell2 = c("D", "A", "F", "C", "F", "B"),
n_cells = c(20, 40, 60, 80, 100, 120)
)
## Run function (suppress printed plot for testing purpose)
net_plot <- suppressMessages(
PlotNetwork(network_df = my_network_df)
)
net_plot$layers
devtools::test()
pkgdown::build_site()
devtools::document()
library(SeuratObject, lib.loc = "/usr/local/lib/R/site-library")
detach("package:SeuratObject", unload = TRUE)
detach("package:Seurat", unload = TRUE)
library(Seurat, lib.loc = "/usr/local/lib/R/site-library")
library(Seurat)
library(SeuratObject)
detach("package:SeuratObject", unload = TRUE)
library(SeuratObject, lib.loc = "/usr/local/lib/R/site-library")
detach("package:SeuratObject", unload = TRUE)
install.packages("SeuratObject")
install.packages("SeuratObject")
library(SeuratObject)
devtools::install()
devtools::install_github('immunogenomics/presto')
pkgdown::build_site()
T_cells_OC_int <- readRDS("/mnt/8TB/users/shameed/shameed/Integrated /T_cells_OC_int.rds")
View(T_cells_OC_int)
cancerData.combined <- readRDS("/mnt/8TB/users/shameed/shameed/Integrated /cancerData.combined.rds")
View(cancerData.combined)
unique(cancerData.combined$sample_name)
devtools::document()
devtools::install()
?GetSignature()
pkgdown::build_site()
devtools::document()
devtools::document()
pkgdown::build_site()
devtools::document()
devtools::install(build_vignettes = T)
pkgdown::build_site()
BiocCheck::BiocCheck("ULM")
#################################
BiocManager::install("BiocCheck")
BiocCheck::BiocCheck("ULM")
setwd('/..')
setwd("/mnt/8TB/users/shameed/shameed/Doublet predictions/scripts/ULM/R")
setwd('..')
setwd('..')
BiocCheck::BiocCheck("ULM")
devtools::document()
devtools::document('ULM')
devtools::install('ULM')
setwd('ULM')
devtools::install(build_vignettes = T)
devtools::test()
pkgdown::build_site()
###############website
usethis::use_pkgdown()
pkgdown::build_site()
usethis::use_pkgdown_github_pages()
usethis::gh_token_help()
usethis::create_github_token()
usethis::use_pkgdown_github_pages()
usethis::edit_r_environ()
Sys.getenv("GITHUB_PAT")
usethis::use_pkgdown_github_pages()
devtools::install(build_vignettes = T)
#######################vignette
usethis::use_vignette("ULM-vignette")
devtools::document() ##update package at intervals
devtools::install(build_vignettes = T)
vignette('ULM')
vignette('ULM')
browseVignettes('ULM')
usethis::use_testthat()
###############website
usethis::use_pkgdown()
pkgdown::build_site() ##reload or update site
pkgdown::build_site() ##reload or update site
devtools::document()
devtools::document()
###############website
usethis::use_pkgdown()
pkgdown::build_site() ##reload or update site
devtools::document()
devtools::document()
###############website
usethis::use_pkgdown()
pkgdown::build_site() ##reload or update site
usethis::use_pkgdown_github_pages()
###############website
usethis::use_pkgdown()
pkgdown::build_site() ##reload or update site
usethis::use_pkgdown_github_pages()
pkgdown::build_site()
