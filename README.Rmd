---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ULM

<!-- badges: start -->
<!-- badges: end -->

An R package for the prediction and identification of multiplets from scRNAseq datasets to infer physical cell-cell interaction networks. Multiplets occur naturally in conventional scRNAseq due to incomplete dissociation during library preparation. They represent cells which are physically connected and interacting in tissues which become sequenced together as they remain unseperated. ULM utilizes a signature-based approach where univariate linear models are fitted over each barcode in a scRNAseq data to assign signature scores. Barcodes are then classified as singlets or multiplets based on their signature scores. Multiplets are those barcodes or cells that are enriched in two or more cell type-specific gene signatures.

![](man/figures/algorithm.jpeg){width=100%}

## Installation

You can install the development version of ULM from [GitHub](https://github.com/) with:


``` r
if (!requireNamespace("devtools", quietly = TRUE)) {
  install.packages("devtools")
}
library(devtools)

devtools::install_github("Sidex71/ULM", build_vignettes = T)
```
A full guide on ULM workflow can be found on the package website https://sidex71.github.io/ULM/articles/ULM-vignette.html  or on the vignettes page by running
```{r}
browseVignettes('ULM') 
```

## Dependencies
This package depends on
        Seurat (>= 3.0.0), 
        decoupleR, 
        tidyverse, 
        dplyr, 
        stringr, 
        igraph, 
        ggraph, 
        tidygraph, 
        ggplot2,
        magrittr,
        tibble.
All required packages might be automatically installed alongside the ULM package.

## Example

This is a quick example which shows how to infer physical cell-cell interaction network from a scRNAseq data:

```{r example, fig.width=8, fig.height=6}
library(ULM)
####load dataset
data("int_singData")  ##int_singData is a preprocessed scRNAseq seurat object with a Cell_Type column containing cell annotations.
##generate signatures
set.seed(101324)
int_sig <- ULM::GetSignature(int_singData, ident_col = int_singData$Cell_Type, n = 100)

###score cells and assign labels
my_scores <- GetCellScores(seurat_obj = int_singData, signatures = int_sig, assay = 'RNA', layer  = 'data')
my_assign <- GetCellAssignments(score_data = my_scores, cut_off = 1, p_val = 0.05)
int_singData <- AddMetaObject(int_singData, cell_class_df = my_assign)

#####filter multiplets
my_mult_filt <- FilterMultiplet(int_singData, minCells = 2, minFreq = 10)
multSummaryFilt <- my_mult_filt$multSummaryFilt

###plot network
my_node_df <- GetNodeDF(mat = multSummaryFilt)
PlotNetwork(my_node_df)
```

A more comprehensive guide on the usage of the ULM package can be found in the following link
https://sidex71.github.io/ULM/articles/ULM-vignette.html
